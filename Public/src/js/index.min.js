var rankImgPath="Public/src/images/rank/",clockImgPath="Public/src/images/clock/",sliderImgPath="Public/src/images/slider/",random,randomArray=[],game=function(){var e,n,t,a,i=$(".pic-container"),r=function(e){layout.indexViewShow(e),layout.sliderContainerFix(),layout.sliderRandomSort(),clock.start()},o=function(n){n?r(n):r(),i.on("click",".one-pic",function(){layout.sliderSelect(this);var n=$(this).find("img").data("index");void 0===e||e===n?e===n?l(n,!0):l(n):d(e,n)?s():e=void 0})},s=function(){t=clock.stop(),t&&(randomArray=[],e=void 0,i.off("click",".one-pic")),util.getRankInfo("index.php?s=/Home/Index/getRank",t,function(e){200===e.status?layout.resultViewShow(t,e.data):alert("你的网络有问题, 刚刚的成绩未生效!")})},d=function(e,n){return $(".one-pic").eq(n).find("img").attr({src:sliderImgPath+randomArray[e]+".png"}).parent().removeClass("selectedSlider").addClass("unselectSlider"),$(".one-pic").eq(e).find("img").attr({src:sliderImgPath+randomArray[n]+".png"}).parent().addClass("unselectSlider").removeClass("selectedSlider"),a=randomArray[e],randomArray[e]=randomArray[n],randomArray[n]=a,a=void 0,c(randomArray)?!0:!1},l=function(n,t){e=t?void 0:n},c=function(e){n=0;for(var t=0;t<=e.length-1;t++)if(e[t]-t!=1){n++;break}return n>0?!1:!0};return{play:o,stop:s}}(),layout=function(){var e,n,t,a,i,r=$("#start"),o=$("#index"),s=$("#result"),d={top:80/1136,bottom:79/1136,left:.2125,right:63/640},l=$(".one-pic"),c=function(e){$(e).removeClass("unselectSlider"),$(e).hasClass("selectedSlider")?($(e).addClass("unselectSlider").removeClass("selectedSlider"),setTimeout(function(){$(e).removeClass("unselectSlider")},200)):$(e).addClass("selectedSlider")},u=function(){$(".pic-container").css({height:100*(1-d.top-d.bottom)+"%",width:100*(1-d.left-d.right)+"%",position:"absolute",top:100*d.top+"%",left:100*d.left+"%"})},m=function(){$(".one-pic").css({"float":"left",height:$(".pic-container").height()/6,width:($(".pic-container").width()-1)/3}),$.each(l,function(e,n){$(n).find("img").attr({src:sliderImgPath+util.randomGenerate()+".png"}).data("index",e)})},f=function(e){e?(o.css("display","block").removeClass("flipOutX").addClass("bounceInRight"),s.removeClass("flipInX").addClass("bounceOutLeft").css("display","none")):(r.addClass("animated bounceOutDown").css("display","none"),o.css("display","block").addClass("animated bounceInDown"))},h=function(e,n){o.removeClass("bounceInDown").addClass("flipOutX").css("display","none"),a(n),i(e),s.css("display","block").addClass("animated flipInX")};return a=function(e){n=$(".rank-info img");for(var t=e.length-1;t>=0;t--)n.eq(t).attr("src",rankImgPath+e[t]+".png").css("display","block")},i=function(n){e=60*(10*n.kilobit+n.hundreds)+10*n.decade+n.theUnit,e=String(e).split("").reverse().join(""),t=$(".spend-time img");for(var a=e.length-1;a>=0;a--)t.eq(a).attr("src",rankImgPath+e[a]+".png").css("display","block")},{sliderSelect:c,indexViewShow:f,resultViewShow:h,sliderRandomSort:m,sliderContainerFix:u}}(),clock=function(){var e,n={theUnit:0,decade:0,hundreds:0,kilobit:0},t=$(".time-counter-container"),a=function(){r(),e=setInterval(function(){9===n.theUnit?(n.theUnit=0,o(0),5===n.decade?(n.decade=0,o(1),9===n.hundreds?(n.hundreds=0,o(3),5===n.kilobit?(o(4,6),i(!0)):o(4,++n.kilobit)):o(3,++n.hundreds)):o(1,++n.decade)):o(0,++n.theUnit)},1001)},i=function(t){return clearInterval(e),tempClockHand=n,n={theUnit:0,decade:0,hundreds:0,kilobit:0},t&&(alert("时间到了!"),location.reload()),tempClockHand},r=function(){t.css({display:"block"}).addClass("animated shake").removeClass("animated shake"),$.each(t.find("img"),function(e,n){2!=e&&$(n).attr("src",clockImgPath+"0.png")})},o=function(e,n){n=n?n:0,t.find("img").eq(e).attr({src:clockImgPath+n+".png"}).addClass("animated fadeInLeft")};return{start:a,stop:i}}(),util=function(){var e=function(){return random=Math.floor(18*Math.random()+1),-1==$.inArray(random,randomArray)?(randomArray.push(random),random):e()},n=function(e,n,t){$.ajax({url:e,type:"POST",data:{spendTime:n},dataType:"json",success:t,error:function(e,n){alert("网络错误, 请重试!")}})};return{getRankInfo:n,randomGenerate:e}}();